<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Á¶èÂà©Ê¥ªÂä® - ÊñáÁ´†ÊéíË°åÊ¶ú & ÂçöÈ•ºÊäΩÂ•ñ</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/layui@2.8.18/dist/css/layui.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .section-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #1E9FFF;
        }

        /* ÂçöÈ•ºÂå∫ÂüüÊ†∑Âºè */
        .mooncake-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .prize-panel {
            width: 100%;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            overflow-x: auto;
            overflow-y: auto;
            max-height: 400px;
            box-sizing: border-box;
        }
        .prize-table {
            width: 100%;
            min-width: 730px;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .prize-table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .prize-table th {
            padding: 12px 10px;
            text-align: left;
            font-weight: bold;
            font-size: 14px;
            white-space: nowrap;
        }
        .prize-table td {
            padding: 10px;
            border-bottom: 1px solid #eee;
            font-size: 13px;
            word-wrap: break-word;
            word-break: break-word;
        }
        .prize-table tbody tr:hover {
            background: #f8f9fa;
        }
        .prize-table tbody tr:last-child td {
            border-bottom: none;
        }

        .dice-area {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            padding: 30px 15px;
            position: relative;
            min-height: 400px;
            box-sizing: border-box;
            overflow: hidden;
        }
        .dice-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            max-width: 100%;
            flex-wrap: wrap;
        }
        .dice {
            width: 80px;
            height: 80px;
            background: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            font-weight: bold;
            color: #333;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s;
            box-sizing: border-box;
        }
        .dice.rolling {
            animation: roll 0.5s infinite;
        }
        @keyframes roll {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(90deg); }
            50% { transform: rotate(180deg); }
            75% { transform: rotate(270deg); }
        }
        .result-display {
            text-align: center;
            color: white;
            margin-top: 20px;
            max-width: 100%;
            padding: 0 10px;
            box-sizing: border-box;
        }
        .result-prize {
            font-size: 32px;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .result-level {
            font-size: 18px;
            margin-top: 5px;
            opacity: 0.9;
        }

        /* SVGÈ™∞Â≠êÊ†∑Âºè */
        .dice-svg-container {
            display: flex;
            gap: 5px;
            justify-content: center;
            margin-top: 10px;
            flex-wrap: nowrap;
        }
        .dice-svg {
            width: 40px;
            height: 40px;
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.3s ease-out;
        }
        .dice-svg.show {
            opacity: 1;
            transform: scale(1);
        }
        .history-dices .dice-svg {
            width: 24px;
            height: 24px;
            opacity: 1;
            transform: scale(1);
        }

        .history-panel {
            width: 100%;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            overflow-y: auto;
            overflow-x: hidden;
            max-height: 400px;
            box-sizing: border-box;
        }
        .history-item {
            background: white;
            border-radius: 6px;
            padding: 10px;
            margin-bottom: 8px;
            font-size: 13px;
            border-left: 3px solid #FFB800;
            word-wrap: break-word;
            box-sizing: border-box;
        }
        .history-time {
            color: #999;
            font-size: 11px;
        }
        .history-result {
            color: #1E9FFF;
            font-weight: bold;
            margin: 5px 0;
        }
        .history-dices {
            color: #666;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 3px;
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media screen and (max-width: 768px) {
            .container {
                padding: 10px;
            }
            .section {
                padding: 15px;
            }
            .dice {
                width: 60px;
                height: 60px;
                font-size: 30px;
            }
            .dice-container {
                gap: 10px;
            }
            .dice-area {
                padding: 20px 10px;
                min-height: 350px;
            }
            .prize-table th,
            .prize-table td {
                padding: 8px 5px;
                font-size: 12px;
            }
        }

        @media screen and (max-width: 480px) {
            .dice {
                width: 50px;
                height: 50px;
                font-size: 24px;
            }
            .result-prize {
                font-size: 24px !important;
            }
            .result-level {
                font-size: 14px !important;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ÊñáÁ´†ÊéíË°åÊ¶úÈÉ®ÂàÜ -->
        <div class="section">
            <div class="section-title">
                <i class="layui-icon layui-icon-chart"></i> ÊñáÁ´†ÊéíË°åÊ¶ú
            </div>
            <table class="layui-hide" id="articleTable" lay-filter="articleTable"></table>
        </div>

        <!-- ÂçöÈ•ºÊäΩÂ•ñÈÉ®ÂàÜ -->
        <div class="section">
            <div class="section-title">
                <i class="layui-icon layui-icon-gift"></i> ÂçöÈ•ºÊäΩÂ•ñ
            </div>
            <div class="mooncake-section">
                <!-- Â∑¶‰æßÔºöÂ•ñÂä±ÂàóË°® -->
                <div class="prize-panel">
                    <h3 style="margin-bottom: 15px; color: #333;">üéÅ Â•ñÂä±ÂàóË°®</h3>
                    <table class="prize-table">
                        <thead>
                            <tr>
                                <th style="width: 100px;">Â•ñÂä±Á≠âÁ∫ß</th>
                                <th style="width: 120px;">Â•ñÈ°πÂêçÁß∞</th>
                                <th style="width: 200px;">Â•ñÈ°πÊèèËø∞</th>
                                <th style="width: 80px;">ÁßØÂàÜ</th>
                                <th style="width: 80px;">Êï∞Èáè</th>
                                <th style="width: 150px;">Â§áÊ≥®</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="6" style="text-align: center; color: #999; padding: 20px;">
                                    ÊöÇÊó†Â•ñÂä±ÂèØÊòæÁ§∫
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- ‰∏≠Èó¥ÔºöÂçöÈ•ºÂå∫Âüü -->
                <div class="dice-area">
                    <h2 style="color: white; margin-bottom: 20px; text-shadow: 2px 2px 4px rgba(0,0,0,0.3);">
                        üé≤ ÂçöÈ•ºÊ∏∏Êàè
                    </h2>
                    <div class="dice-container">
                        <div class="dice" id="dice1">?</div>
                        <div class="dice" id="dice2">?</div>
                        <div class="dice" id="dice3">?</div>
                        <div class="dice" id="dice4">?</div>
                        <div class="dice" id="dice5">?</div>
                        <div class="dice" id="dice6">?</div>
                    </div>
                    <button class="layui-btn layui-btn-danger layui-btn-lg" id="rollBtn">
                        <i class="layui-icon layui-icon-play"></i> ÂºÄÂßãÂçöÈ•º
                    </button>
                </div>

                <!-- Âè≥‰æßÔºöÂçöÈ•ºËÆ∞ÂΩï -->
                <div class="history-panel">
                    <h3 style="margin-bottom: 15px; color: #333;">üìú ÂçöÈ•ºËÆ∞ÂΩï</h3>
                    <div id="historyList">
                        <div style="text-align: center; color: #999; padding: 20px;">
                            ÊöÇÊó†ËÆ∞ÂΩïÔºåÂø´Êù•ËØïËØïÊâãÊ∞îÂêßÔºÅ
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/layui@2.8.18/dist/layui.js"></script>
    <script>
        layui.use(['table', 'layer'], function(){
            var table = layui.table;
            var layer = layui.layer;

            // ÂÖ®Â±ÄÂ•ñÂä±Êï∞ÊçÆ
            let rewardsData = [];

            // Âä†ËΩΩÂ•ñÂä±ÂàóË°®
            function loadRewards() {
                fetch('/api/collections/rewards/records?expand=awards_via_rewardId&sort=-level')
                    .then(response => response.json())
                    .then(data => {
                        if(data.items && data.items.length > 0) {
                            rewardsData = data.items;
                            renderRewardsList();
                        }
                    })
                    .catch(error => {
                        console.error('Âä†ËΩΩÂ•ñÂä±ÂàóË°®Â§±Ë¥•:', error);
                        layer.msg('Â•ñÂä±ÂàóË°®Âä†ËΩΩÂ§±Ë¥•', {icon: 2});
                    });
            }

            // Ê∏≤ÊüìÂ•ñÂä±ÂàóË°®
            function renderRewardsList() {
                const prizeTableBody = document.querySelector('.prize-table tbody');
                if(!prizeTableBody) return;

                // Ê∏ÖÁ©∫Áé∞ÊúâÂÜÖÂÆπ
                prizeTableBody.innerHTML = '';

                if(rewardsData.length === 0) {
                    prizeTableBody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: #999; padding: 20px;">ÊöÇÊó†Â•ñÂä±Êï∞ÊçÆ</td></tr>';
                    return;
                }

                // ÈÅçÂéÜÊØè‰∏™ rewardÔºàÂ∑≤ÁªèÊåâ level ÂÄíÂ∫èÔºâ
                rewardsData.forEach(reward => {
                    const awards = reward.expand && reward.expand.awards_via_rewardId ? reward.expand.awards_via_rewardId : [];

                    // Êåâ award level ÊéíÂ∫èÔºàÂÄíÂ∫èÔºâ
                    awards.sort((a, b) => (b.level || 0) - (a.level || 0));

                    // Â¶ÇÊûúÊ≤°ÊúâÂÖ≥ËÅîÁöÑ awardsÔºåÊòæÁ§∫‰∏ÄË°åreward‰ø°ÊÅØ
                    if(awards.length === 0) {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td style="font-weight: bold; color: #FF5722; font-size: 16px; text-align: center; vertical-align: middle;">${reward.name}</td>
                            <td style="color: #999; text-align: center;">-</td>
                            <td style="color: #999; text-align: center;">-</td>
                            <td style="font-weight: 500; color: #1E9FFF; text-align: center;">${reward.point || 0}</td>
                            <td style="color: #999; text-align: center;">${reward.amount || '-'}</td>
                            <td style="color: #999; text-align: center; font-size: 12px;">${reward.more || '-'}</td>
                        `;
                        prizeTableBody.appendChild(row);
                        return;
                    }

                    // ‰∏∫ÊØè‰∏™ award ÂàõÂª∫‰∏ÄË°å
                    awards.forEach((award, index) => {
                        const row = document.createElement('tr');

                        // Á¨¨‰∏ÄË°åÈúÄË¶ÅÊ∑ªÂä† rowspan ÁöÑÂ•ñÂä±Á≠âÁ∫ßÂàó
                        if(index === 0) {
                            const rewardCell = document.createElement('td');
                            rewardCell.rowSpan = awards.length;
                            rewardCell.style.cssText = 'font-weight: bold; color: #FF5722; font-size: 16px; text-align: center; vertical-align: middle; border-right: 2px solid #eee;';
                            rewardCell.textContent = reward.name;
                            row.appendChild(rewardCell);
                        }

                        // Â•ñÈ°πÂêçÁß∞
                        const nameCell = document.createElement('td');
                        nameCell.style.cssText = 'font-weight: bold; color: #1E9FFF;';
                        nameCell.textContent = award.name || '-';
                        row.appendChild(nameCell);

                        // Â•ñÈ°πÊèèËø∞
                        const descCell = document.createElement('td');
                        descCell.style.cssText = 'font-size: 12px; color: #666;';
                        descCell.textContent = award.description || '-';
                        row.appendChild(descCell);

                        // ÁßØÂàÜÔºàÂè™Âú®Á¨¨‰∏ÄË°åÊòæÁ§∫Ôºå‰ΩøÁî®rowspanÔºâ
                        if(index === 0) {
                            const pointCell = document.createElement('td');
                            pointCell.rowSpan = awards.length;
                            pointCell.style.cssText = 'font-weight: 500; color: #1E9FFF; text-align: center; vertical-align: middle; font-size: 16px;';
                            pointCell.textContent = reward.point || 0;
                            row.appendChild(pointCell);

                            // Êï∞ÈáèÔºàamountÔºâ
                            const amountCell = document.createElement('td');
                            amountCell.rowSpan = awards.length;
                            amountCell.style.cssText = 'font-weight: 500; color: #666; text-align: center; vertical-align: middle;';
                            amountCell.textContent = reward.amount || '-';
                            row.appendChild(amountCell);

                            // Â§áÊ≥®ÔºàmoreÔºâ
                            const moreCell = document.createElement('td');
                            moreCell.rowSpan = awards.length;
                            moreCell.style.cssText = 'color: #999; text-align: left; vertical-align: middle; font-size: 12px;';
                            moreCell.textContent = reward.more || '-';
                            row.appendChild(moreCell);
                        }

                        prizeTableBody.appendChild(row);
                    });
                });
            }

            // È°µÈù¢Âä†ËΩΩÊó∂Ëé∑ÂèñÂ•ñÂä±Êï∞ÊçÆ
            loadRewards();

            // ÊñáÁ´†ÊéíË°åÊ¶úË°®Ê†º
            table.render({
                elem: '#articleTable',
                url: '/api/collections/articles/records?expand=userId&sort=-createdAt',
                height: 500,
                page: true,
                limit: 10,
                limits: [10, 20, 50, 100],
                cols: [[
                    {field: 'title', title: 'ÊñáÁ´†Ê†áÈ¢ò', width: 350, templet: function(d){
                        return '<a href="https://fishpi.cn/article/' + d.oId + '" target="_blank" style="color: #1E9FFF; text-decoration: none;">' + d.title + '</a>';
                    }},
                    {field: 'expand', title: '‰ΩúËÄÖ', width: 200, templet: function(d){
                        if(d.expand && d.expand.userId) {
                            const user = d.expand.userId;
                            const displayName = user.nickname || user.name || '-';
                            const memberName = user.name || '';
                            const avatar = user.avatar || '';
                            const avatarHtml = '<img src="' + avatar + '" alt="avatar" style="width: 30px; height: 30px; border-radius: 50%; object-fit: cover;" />';
                            if(memberName) {
                                const memberUrl = 'https://fishpi.cn/member/' + encodeURIComponent(memberName);
                                return '<a href="' + memberUrl + '" target="_blank" style="display: flex; align-items: center; gap: 8px; color: inherit; text-decoration: none;">' +
                                       avatarHtml +
                                       '<span>' + displayName + '</span>' +
                                       '</a>';
                            }
                            return '<div style="display: flex; align-items: center; gap: 8px;">' + avatarHtml + '<span>' + displayName + '</span></div>';
                        }
                        return '-';
                    }},
                    {field: 'viewCount', title: 'ÊµèËßàÈáè', width: 100, sort: true},
                    {field: 'goodCnt', title: 'ÁÇπËµûÈáè', width: 100, sort: true},
                    {field: 'commentCount', title: 'ËØÑËÆ∫Êï∞', width: 100, sort: true},
                    {field: 'collectCnt', title: 'Êî∂ËóèÈáè', width: 100, sort: true},
                    {field: 'thankCnt', title: 'ÊÑüË∞¢Êï∞', width: 100, sort: true},
                    {field: 'created', title: 'ÂàõÂª∫Êó∂Èó¥', width: 180, sort: true, templet: function(d){
                        // prefer createdAt (original article timestamp) and fall back to created (PB metadata)
                        return formatDate(d.createdAt || d.created);
                     }},
                     {field: 'updated', title: 'Êõ¥Êñ∞Êó∂Èó¥', width: 180, sort: true, templet: function(d){
                        return formatDate(d.updatedAt || d.updated);
                     }}
                ]],
                parseData: function(res){
                    return {
                        "code": 0,
                        "msg": "",
                        "count": res.totalItems,
                        "data": res.items
                    };
                }
            });

            // ÂçöÈ•ºÊ∏∏ÊàèÈÄªËæë
            let isRolling = false;
            let history = [];

            document.getElementById('rollBtn').addEventListener('click', function(){
                if(isRolling) return;

                isRolling = true;

                // ÂÖàÁîüÊàêÊâÄÊúâÈ™∞Â≠êÁöÑÁªìÊûú
                const result = rollDices();
                const dices = document.querySelectorAll('.dice');

                // Á¨¨‰∏ÄÊ≠•ÔºöÊâÄÊúâÈ™∞Â≠êÂõûÂà∞ÂàùÂßãÁä∂ÊÄÅÂπ∂‰∏ÄËµ∑ÂºÄÂßãÊëáÂä®
                dices.forEach(dice => {
                    dice.textContent = '?';
                    dice.classList.add('rolling');
                });

                // Á¨¨‰∫åÊ≠•Ôºö1ÁßíÂêéÔºå‰æùÊ¨°ÊòæÁ§∫ÊØè‰∏™È™∞Â≠êÁöÑÁªìÊûú
                setTimeout(() => {
                    let completedCount = 0;

                    dices.forEach((dice, index) => {
                        setTimeout(() => {
                            dice.classList.remove('rolling');
                            dice.innerHTML = `<img src="data:image/svg+xml;base64,${getDiceSVGBase64(result.dices[index])}" alt="dice-${result.dices[index]}" style="width: 60px; height: 60px;" />`;

                            completedCount++;

                            // ÊâÄÊúâÈ™∞Â≠êÈÉΩÂÆåÊàêÂêé
                            if(completedCount === 6) {
                                // Ê∑ªÂä†Âà∞ÂéÜÂè≤ËÆ∞ÂΩï
                                addHistory(result);

                                isRolling = false;

                                // ÊòæÁ§∫ÊèêÁ§∫
                                setTimeout(() => {
                                    layer.msg('ÊÅ≠ÂñúËé∑ÂæóÔºö' + result.prizeName, {icon: 1, time: 2000});
                                }, 200);
                            }
                        }, index * 200); // ÊØè‰∏™È™∞Â≠êÈó¥Èöî200msÊòæÁ§∫ÁªìÊûú
                    });
                }, 1000); // ÊâÄÊúâÈ™∞Â≠ê‰∏ÄËµ∑ÊëáÂä®1ÁßíÂêéÂºÄÂßã‰æùÊ¨°ÊòæÁ§∫ÁªìÊûú
            });

            // Ê®°ÊãüÊé∑È™∞Â≠ê
            function rollDices() {
                const dices = [];
                for(let i = 0; i < 6; i++) {
                    dices.push(Math.floor(Math.random() * 6) + 1);
                }

                const prize = calculatePrize(dices);
                return {
                    dices: dices,
                    prizeName: prize.name,
                    prizeLevel: prize.level
                };
            }

            // ËÆ°ÁÆóÂ•ñÂä±
            function calculatePrize(dices) {
                const counts = {};
                dices.forEach(d => {
                    counts[d] = (counts[d] || 0) + 1;
                });

                const count4 = counts[4] || 0;

                if(count4 === 6) return {name: 'Áä∂ÂÖÉÂÖ≠ÂãÉÁ∫¢', level: 12};
                if(count4 === 4 && counts[1] === 2) return {name: 'Áä∂ÂÖÉÊèíÈáëËä±', level: 11};
                if(counts[1] === 6) return {name: 'Áä∂ÂÖÉÈÅçÂú∞Èî¶', level: 10};

                for(let d in counts) {
                    const dn = Number(d);
                    if(counts[d] === 6 && dn !== 1 && dn !== 4) {
                        return {name: 'Áä∂ÂÖÉÈªëÂÖ≠ÂãÉ', level: 9};
                    }
                }

                if(count4 === 5) return {name: 'Áä∂ÂÖÉ‰∫îÁ∫¢', level: 8};

                for(let d in counts) {
                    const dn = Number(d);
                    if(counts[d] === 5 && dn !== 4) {
                        return {name: 'Áä∂ÂÖÉ‰∫îÂ≠êÁôªÁßë', level: 7};
                    }
                }

                if(count4 === 4) return {name: 'Áä∂ÂÖÉÂõõÁÇπÁ∫¢', level: 6};

                if(Object.keys(counts).length === 6) {
                    let hasAll = true;
                    for(let i = 1; i <= 6; i++) {
                        if(counts[i] !== 1) hasAll = false;
                    }
                    if(hasAll) return {name: 'ÂØπÂ†Ç', level: 5};
                }

                if(count4 === 3) return {name: '‰∏âÁ∫¢', level: 4};

                for(let d in counts) {
                    const dn = Number(d);
                    if(counts[d] === 4 && dn !== 4) {
                        return {name: 'ÂõõËøõ', level: 3};
                    }
                }

                if(count4 === 2) return {name: '‰∫å‰∏æ', level: 2};
                if(count4 === 1) return {name: '‰∏ÄÁßÄ', level: 1};

                return {name: 'Êó†Â•ñ', level: 0};
            }

            // Ê∑ªÂä†ÂéÜÂè≤ËÆ∞ÂΩï
            function addHistory(result) {
                const now = new Date();
                history.unshift({
                    time: formatDate(now),
                    result: result
                });

                // Âè™‰øùÁïôÊúÄËøë20Êù°
                if(history.length > 20) {
                    history = history.slice(0, 20);
                }

                updateHistoryDisplay();
            }

            // Êõ¥Êñ∞ÂéÜÂè≤ËÆ∞ÂΩïÊòæÁ§∫
            function updateHistoryDisplay() {
                const historyList = document.getElementById('historyList');
                if(history.length === 0) {
                    historyList.innerHTML = '<div style="text-align: center; color: #999; padding: 20px;">ÊöÇÊó†ËÆ∞ÂΩï</div>';
                    return;
                }

                historyList.innerHTML = history.map(h => `
                    <div class="history-item">
                        <div class="history-time">${h.time}</div>
                        <div class="history-result">${h.result.prizeName}</div>
                        <div class="history-dices" style="display: flex; align-items: center; gap: 3px;">
                            ${h.result.dices.map(d => `<img src="data:image/svg+xml;base64,${getDiceSVGBase64(d)}" alt="dice-${d}" class="dice-svg" />`).join('')}
                        </div>
                    </div>
                `).join('');
            }

            // Ê†ºÂºèÂåñÊó•Êúü
            function formatDate(date) {
                if(!date) return '-';
                // Accept Date or various string formats from API. Normalize strings like "YYYY-MM-DD hh:mm:ss.sssZ" -> "YYYY-MM-DDThh:mm:ss.sssZ"
                try {
                    if(typeof date === 'string') {
                        let s = date.trim();
                        // if contains space and no 'T', replace first space with 'T'
                        if(s.indexOf('T') === -1 && s.indexOf(' ') !== -1) {
                            s = s.replace(' ', 'T');
                        }
                        date = new Date(s);
                    }

                    if(!(date instanceof Date) || isNaN(date.getTime())) return '-';

                    const year = date.getFullYear();
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const day = String(date.getDate()).padStart(2, '0');
                    const hour = String(date.getHours()).padStart(2, '0');
                    const minute = String(date.getMinutes()).padStart(2, '0');
                    const second = String(date.getSeconds()).padStart(2, '0');
                    return `${year}-${month}-${day} ${hour}:${minute}:${second}`;
                } catch (e) {
                    return '-';
                }
             }


            // Ëé∑ÂèñÈ™∞Â≠êSVGÁöÑBase64ÁºñÁ†Å
            function getDiceSVGBase64(d) {
                const svgs = {
                    1: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" rx="15" fill="#fff" stroke="#333" stroke-width="2"/><circle cx="50" cy="50" r="8" fill="red"/></svg>`,
                    2: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" rx="15" fill="#fff" stroke="#333" stroke-width="2"/><circle cx="30" cy="30" r="8" fill="#333"/><circle cx="70" cy="70" r="8" fill="#333"/></svg>`,
                    3: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" rx="15" fill="#fff" stroke="#333" stroke-width="2"/><circle cx="30" cy="30" r="8" fill="#333"/><circle cx="50" cy="50" r="8" fill="#333"/><circle cx="70" cy="70" r="8" fill="#333"/></svg>`,
                    4: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" rx="15" fill="#fff" stroke="#333" stroke-width="2"/><circle cx="30" cy="30" r="8" fill="red"/><circle cx="70" cy="30" r="8" fill="red"/><circle cx="30" cy="70" r="8" fill="red"/><circle cx="70" cy="70" r="8" fill="red"/></svg>`,
                    5: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" rx="15" fill="#fff" stroke="#333" stroke-width="2"/><circle cx="30" cy="30" r="8" fill="#333"/><circle cx="70" cy="30" r="8" fill="#333"/><circle cx="50" cy="50" r="8" fill="#333"/><circle cx="30" cy="70" r="8" fill="#333"/><circle cx="70" cy="70" r="8" fill="#333"/></svg>`,
                    6: `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" rx="15" fill="#fff" stroke="#333" stroke-width="2"/><circle cx="30" cy="25" r="8" fill="#333"/><circle cx="70" cy="25" r="8" fill="#333"/><circle cx="30" cy="50" r="8" fill="#333"/><circle cx="70" cy="50" r="8" fill="#333"/><circle cx="30" cy="75" r="8" fill="#333"/><circle cx="70" cy="75" r="8" fill="#333"/></svg>`
                };

                return btoa(unescape(encodeURIComponent(svgs[d])));
            }
        });
    </script>
</body>
</html>
