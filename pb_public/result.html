<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ´»åŠ¨ç»“æœ - æ‘¸é±¼æ´¾ç¥ç¦æ´»åŠ¨</title>
    <link rel="stylesheet" href="https://unpkg.com/layui@2.8.18/dist/css/layui.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        /* å¯¼èˆªå¤´éƒ¨ */
        .nav-header {
            background: white;
            border-radius: 10px;
            padding: 15px 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        .nav-logo {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }
        .nav-menu {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .nav-item {
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #333;
            text-decoration: none;
            font-size: 14px;
        }
        .nav-item:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        /* æ´»åŠ¨ä¿¡æ¯å¡ç‰‡ */
        .activity-info {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .activity-title {
            font-size: 32px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .activity-desc {
            text-align: center;
            color: #666;
            font-size: 16px;
            line-height: 1.8;
            margin-bottom: 20px;
        }

        /* åšé¥¼ç»“æœå¡ç‰‡ */
        .section-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .section-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .section-title .icon {
            font-size: 28px;
        }

        /* åšé¥¼ä¿¡æ¯ */
        .reward-level-section {
            margin-bottom: 30px;
        }
        .reward-level-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 15px;
            font-size: 20px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .reward-level-header.level-1 {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
        }
        .reward-level-header.level-2 {
            background: linear-gradient(135deg, #C0C0C0 0%, #808080 100%);
        }
        .reward-level-header.level-3 {
            background: linear-gradient(135deg, #CD7F32 0%, #8B4513 100%);
        }

        /* çŠ¶å…ƒå±•ç¤º */
        .champion-card {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
            position: relative;
            overflow: hidden;
            margin-bottom: 15px;
        }
        .champion-card::before {
            content: 'ğŸ‘‘';
            position: absolute;
            top: -10px;
            right: -10px;
            font-size: 80px;
            opacity: 0.2;
        }
        .champion-user {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        .champion-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        .champion-info h3 {
            margin: 0;
            font-size: 18px;
            color: #8B4513;
        }
        .champion-info p {
            margin: 5px 0 0 0;
            font-size: 14px;
            color: #A0522D;
        }
        .champion-details {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            padding: 12px;
            margin-top: 10px;
        }
        .dice-display {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin: 10px 0;
            flex-wrap: wrap;
        }
        .dice-svg {
            width: 50px;
            height: 50px;
        }

        /* æ™®é€šå¥–é¡¹å±•ç¤º */
        .reward-winners-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
        }
        .reward-winner-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }
        .reward-winner-card:hover {
            background: #e9ecef;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .reward-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid #667eea;
        }
        .reward-user-info {
            flex: 1;
        }
        .reward-user-info h4 {
            margin: 0 0 5px 0;
            font-size: 16px;
            color: #333;
        }
        .reward-user-info p {
            margin: 0;
            font-size: 14px;
            color: #666;
        }
        .reward-count {
            font-size: 20px;
            font-weight: bold;
            color: #667eea;
        }

        /* ç¦ç­¾ç»Ÿè®¡ - ä¸‰åˆ—å¹¶æ’æ˜¾ç¤º */
        .votes-grid-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 25px;
            margin-top: 25px;
        }
        .vote-category-section {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        }
        .vote-category-header {
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-bottom: 3px solid;
        }
        .vote-category-header.career {
            border-bottom-color: #FF6B6B;
            background: linear-gradient(135deg, #FFE5E5 0%, #FFD1D1 100%);
        }
        .vote-category-header.romance {
            border-bottom-color: #FF69B4;
            background: linear-gradient(135deg, #FFE5F5 0%, #FFD1E8 100%);
        }
        .vote-category-header.wealth {
            border-bottom-color: #FFD700;
            background: linear-gradient(135deg, #FFF8E5 0%, #FFEEB3 100%);
        }
        .category-icon {
            font-size: 28px;
        }
        .category-title {
            flex: 1;
            font-size: 18px;
            font-weight: bold;
            color: #333;
        }
        .category-count {
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* ç¦ç­¾æ¥æ”¶è€…å¡ç‰‡ */
        .vote-recipient-card {
            background: white;
            border-radius: 0;
            padding: 18px;
            margin: 0;
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.3s ease;
        }
        .vote-recipient-card:last-child {
            border-bottom: none;
        }
        .vote-recipient-card:hover {
            background: #f8f9fa;
            transform: translateX(3px);
        }
        .vote-recipient-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid #f8f9fa;
        }
        .vote-recipient-rank {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            flex-shrink: 0;
        }
        .vote-recipient-rank.top-1 {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            width: 38px;
            height: 38px;
            font-size: 18px;
        }
        .vote-recipient-rank.top-2 {
            background: linear-gradient(135deg, #C0C0C0 0%, #808080 100%);
            width: 36px;
            height: 36px;
            font-size: 16px;
        }
        .vote-recipient-rank.top-3 {
            background: linear-gradient(135deg, #CD7F32 0%, #8B4513 100%);
            width: 36px;
            height: 36px;
            font-size: 16px;
        }
        .vote-recipient-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid #667eea;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .vote-recipient-info {
            flex: 1;
            min-width: 0;
        }
        .vote-recipient-name {
            font-size: 15px;
            font-weight: bold;
            color: #333;
            margin: 0 0 4px 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .vote-recipient-username {
            font-size: 12px;
            color: #999;
            margin: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .vote-recipient-stats {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 2px;
        }
        .vote-recipient-count {
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .vote-recipient-label {
            font-size: 11px;
            color: #999;
        }
        .vote-voters-section {
            margin-top: 12px;
            padding-top: 12px;
        }
        .vote-voters-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
        }
        .vote-voters-title {
            font-size: 12px;
            font-weight: 600;
            color: #666;
        }
        .vote-voters-grid {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .voter-card {
            display: flex;
            align-items: center;
            gap: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            padding: 8px;
            transition: all 0.2s ease;
        }
        .voter-card:hover {
            background: #e9ecef;
            transform: translateX(3px);
        }
        .voter-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .voter-info {
            flex: 1;
            min-width: 0;
        }
        .voter-name {
            font-size: 13px;
            font-weight: 600;
            color: #333;
            margin: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .voter-time {
            font-size: 11px;
            color: #999;
            margin: 2px 0 0 0;
        }

        /* æ–‡ç« æ’å */
        .article-list {
            margin-top: 20px;
        }
        .article-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .article-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .article-header {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin-bottom: 15px;
        }
        .article-rank {
            font-size: 28px;
            font-weight: bold;
            color: #667eea;
            min-width: 50px;
        }
        .article-rank.top-1 {
            color: #FFD700;
        }
        .article-rank.top-2 {
            color: #C0C0C0;
        }
        .article-rank.top-3 {
            color: #CD7F32;
        }
        .article-content {
            flex: 1;
        }
        .article-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .article-preview {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 10px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .article-author {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .article-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
        }
        .article-stats {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            font-size: 13px;
            color: #999;
        }
        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .stat-item .icon {
            font-size: 16px;
        }
        .article-votes {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .vote-badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }
        .vote-badge.career {
            background: #FFE5E5;
            color: #FF6B6B;
        }
        .vote-badge.romance {
            background: #FFE5F5;
            color: #FF69B4;
        }
        .vote-badge.wealth {
            background: #FFF8E5;
            color: #FFB900;
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }
        .empty-state .icon {
            font-size: 60px;
            margin-bottom: 10px;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            text-align: center;
            padding: 40px;
        }

        @media (max-width: 768px) {
            .votes-grid-container {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            .vote-recipient-header {
                gap: 10px;
            }
            .vote-recipient-rank {
                width: 28px;
                height: 28px;
                font-size: 12px;
            }
            .vote-recipient-rank.top-1 {
                width: 34px;
                height: 34px;
                font-size: 16px;
            }
            .vote-recipient-rank.top-2,
            .vote-recipient-rank.top-3 {
                width: 32px;
                height: 32px;
                font-size: 14px;
            }
            .vote-recipient-avatar {
                width: 45px;
                height: 45px;
            }
            .vote-recipient-name {
                font-size: 14px;
            }
            .vote-recipient-count {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <div class="nav-header">
        <div class="nav-logo">ğŸ‰ æ‘¸é±¼æ´¾ç¥ç¦æ´»åŠ¨</div>
        <div class="nav-menu">
            <a href="/" class="nav-item">ğŸ  é¦–é¡µ</a>
            <a href="/result.html" class="nav-item" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">ğŸ“Š æ´»åŠ¨ç»“æœ</a>
        </div>
    </div>

    <!-- æ´»åŠ¨ä¿¡æ¯ -->
    <div class="activity-info">
        <div class="activity-title">ğŸŠ æ´»åŠ¨ç»“æœå…¬ç¤º ğŸŠ</div>
        <div class="activity-desc">
            æ„Ÿè°¢å„ä½é±¼æ²¹çš„çƒ­æƒ…å‚ä¸ï¼æœ¬æ¬¡æ´»åŠ¨åœ†æ»¡ç»“æŸï¼Œä»¥ä¸‹æ˜¯æ´»åŠ¨æœ€ç»ˆç»“æœã€‚<br>
            åŒ…æ‹¬åšé¥¼çŠ¶å…ƒã€å‚ä¸ç»Ÿè®¡ã€ç¦ç­¾è·å¾—æƒ…å†µä»¥åŠæ–‡ç« ç»¼åˆæ’åã€‚
        </div>
    </div>

    <!-- åšé¥¼ä¿¡æ¯ -->
    <div class="section-card" id="gamingSection">
        <div class="section-title">
            <span class="icon">ğŸ²</span>
            <span>åšé¥¼ä¿¡æ¯</span>
        </div>
        <div id="gamingResultsContainer">
            <div class="loading">åŠ è½½ä¸­...</div>
        </div>
    </div>

    <!-- ç¦ç­¾è·å¾—ç»Ÿè®¡ -->
    <div class="section-card" id="votesSection">
        <div class="section-title">
            <span class="icon">ğŸ®</span>
            <span>ç¦ç­¾è·å¾—ç»Ÿè®¡</span>
        </div>
        <div class="votes-grid-container">
            <div class="vote-category-section">
                <div class="vote-category-header career">
                    <span class="category-icon">ğŸš€</span>
                    <span class="category-title">äº‹ä¸šç¬¦</span>
                    <span class="category-count" id="careerCount">0</span>
                </div>
                <div id="careerVotesContent">
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>

            <div class="vote-category-section">
                <div class="vote-category-header romance">
                    <span class="category-icon">ğŸ’</span>
                    <span class="category-title">å§»ç¼˜ç¬¦</span>
                    <span class="category-count" id="romanceCount">0</span>
                </div>
                <div id="romanceVotesContent">
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>

            <div class="vote-category-section">
                <div class="vote-category-header wealth">
                    <span class="category-icon">ğŸ’°</span>
                    <span class="category-title">æ‹›è´¢ç¬¦</span>
                    <span class="category-count" id="wealthCount">0</span>
                </div>
                <div id="wealthVotesContent">
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ–‡ç« ç»¼åˆæ’å -->
    <div class="section-card" id="articlesSection">
        <div class="section-title">
            <span class="icon">ğŸ“</span>
            <span>æ–‡ç« ç»¼åˆæ’å</span>
        </div>
        <div class="article-list" id="articlesList">
            <div class="loading">åŠ è½½ä¸­...</div>
        </div>
    </div>

    <script src="https://unpkg.com/layui@2.8.18/dist/layui.js"></script>
    <script>
        // åŠ è½½æ´»åŠ¨ç»“æœæ•°æ®
        async function loadActivityResult() {
            try {
                const response = await fetch('/activity/result');
                if (!response.ok) {
                    throw new Error('åŠ è½½å¤±è´¥');
                }
                const data = await response.json();

                renderGamingResults(data.gaming_results || []);
                renderVotes(data.votes || {});
                renderArticles(data.article_rankings || []);
            } catch (error) {
                console.error('åŠ è½½æ´»åŠ¨ç»“æœå¤±è´¥:', error);
                layui.layer.msg('åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•', {icon: 2});
            }
        }

        // ç”Ÿæˆéª°å­SVG
        function createDiceSVG(value) {
            const positions = {
                1: [[50, 50]],
                2: [[30, 30], [70, 70]],
                3: [[30, 30], [50, 50], [70, 70]],
                4: [[30, 30], [30, 70], [70, 30], [70, 70]],
                5: [[30, 30], [30, 70], [50, 50], [70, 30], [70, 70]],
                6: [[30, 30], [30, 50], [30, 70], [70, 30], [70, 50], [70, 70]]
            };

            // åªæœ‰1å’Œ4æ˜¯çº¢è‰²ï¼Œå…¶ä»–éƒ½æ˜¯é»‘è‰²
            const dotColor = (value === 1 || value === 4) ? '#DC143C' : '#000000';

            const dots = positions[value] || [];
            const dotsHtml = dots.map(([cx, cy]) =>
                `<circle cx="${cx}" cy="${cy}" r="8" fill="${dotColor}"/>`
            ).join('');

            return `
                <svg class="dice-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <rect x="5" y="5" width="90" height="90" rx="12" fill="white" stroke="#333" stroke-width="2"/>
                    ${dotsHtml}
                </svg>
            `;
        }

        // æ¸²æŸ“åšé¥¼ä¿¡æ¯
        function renderGamingResults(results) {
            const container = document.getElementById('gamingResultsContainer');
            if (results.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="icon">ğŸ²</div><p>æš‚æ— åšé¥¼æ•°æ®</p></div>';
                return;
            }

            // æŒ‰å¥–åŠ±ç­‰çº§åˆ†ç»„ï¼ŒåŒæ—¶åŒºåˆ†æœ€ç»ˆçŠ¶å…ƒå’Œæ™®é€šè·å¥–
            const groupedByLevel = {};
            results.forEach(result => {
                const level = result.reward_level;
                if (!groupedByLevel[level]) {
                    groupedByLevel[level] = {
                        name: result.reward_name,
                        champions: [], // isBest=trueçš„æœ€ç»ˆçŠ¶å…ƒ
                        winners: []    // å…¶ä»–è·å¥–è€…
                    };
                }

                if (result.is_best) {
                    groupedByLevel[level].champions.push(result);
                } else {
                    groupedByLevel[level].winners.push(result);
                }
            });

            // æŒ‰ç­‰çº§é™åºæ’åº
            const sortedLevels = Object.keys(groupedByLevel).sort((a, b) => b - a);

            let html = '';
            sortedLevels.forEach(level => {
                const levelData = groupedByLevel[level];
                const levelClass = level >= 6 ? 'level-1' : level >= 4 ? 'level-2' : level >= 2 ? 'level-3' : '';
                const isChampionLevel = parseInt(level) >= 6; // ç­‰çº§6åŠä»¥ä¸Šä¸ºçŠ¶å…ƒç­‰çº§

                html += `
                    <div class="reward-level-section">
                        <div class="reward-level-header ${levelClass}">
                            ${isChampionLevel ? 'ğŸ‘‘' : 'ğŸ'} ${levelData.name}
                        </div>
                `;

                // æ¸²æŸ“æœ€ç»ˆçŠ¶å…ƒï¼ˆisBest=trueï¼‰- æ˜¾ç¤ºéª°å­
                if (levelData.champions.length > 0) {
                    levelData.champions.forEach(champion => {
                        const details = JSON.parse(champion.details || '[]');
                        const diceHtml = details.map(d => createDiceSVG(d)).join('');

                        html += `
                            <div class="champion-card">
                                <div class="champion-user">
                                    <img src="${champion.avatar || 'https://pwl.stackoverflow.wiki/avatar/' + champion.user_id}"
                                         alt="${champion.nickname}" class="champion-avatar"
                                         onerror="this.src='https://pwl.stackoverflow.wiki/avatar/${champion.user_id}'">
                                    <div class="champion-info">
                                        <h3>${champion.nickname || champion.username}</h3>
                                        <p>@${champion.username}</p>
                                    </div>
                                </div>
                                <div class="champion-details">
                                    <div style="text-align: center; margin-bottom: 8px; font-weight: bold; color: #8B4513;">
                                        ${isChampionLevel ? 'ğŸ† æœ€ç»ˆçŠ¶å…ƒ' : 'ğŸ¯ æœ€ç»ˆè·å¥–'} Â· å…±è·å¾— ${champion.count} æ¬¡ Â· ç¬¬ ${champion.times} æ¬¡åšé¥¼
                                    </div>
                                    <div class="dice-display">
                                        ${diceHtml}
                                    </div>
                                    <div style="text-align: center; margin-top: 8px; font-size: 12px; color: #999;">
                                        ${new Date(champion.created).toLocaleString('zh-CN')}
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                }

                // æ¸²æŸ“å…¶ä»–è·å¥–è€…
                if (levelData.winners.length > 0) {
                    // çŠ¶å…ƒç­‰çº§ï¼ˆlevel >= 6ï¼‰æ˜¾ç¤ºéª°å­ï¼Œå…¶ä»–ç­‰çº§æ˜¾ç¤ºäººå’Œæ¬¡æ•°
                    if (isChampionLevel) {
                        // å¤±è´¥çš„çŠ¶å…ƒä¹Ÿæ˜¾ç¤ºéª°å­
                        levelData.winners.forEach(winner => {
                            const details = JSON.parse(winner.details || '[]');
                            const diceHtml = details.map(d => createDiceSVG(d)).join('');

                            html += `
                                <div class="champion-card" style="background: linear-gradient(135deg, #E0E0E0 0%, #BDBDBD 100%);">
                                    <div class="champion-user">
                                        <img src="${winner.avatar || 'https://pwl.stackoverflow.wiki/avatar/' + winner.user_id}"
                                             alt="${winner.nickname}" class="champion-avatar"
                                             onerror="this.src='https://pwl.stackoverflow.wiki/avatar/${winner.user_id}'">
                                        <div class="champion-info">
                                            <h3>${winner.nickname || winner.username}</h3>
                                            <p>@${winner.username}</p>
                                        </div>
                                    </div>
                                    <div class="champion-details">
                                        <div style="text-align: center; margin-bottom: 8px; font-weight: bold; color: #8B4513;">
                                            å…±è·å¾— ${winner.count} æ¬¡ Â· ç¬¬ ${winner.times} æ¬¡åšé¥¼
                                        </div>
                                        <div class="dice-display">
                                            ${diceHtml}
                                        </div>
                                        <div style="text-align: center; margin-top: 8px; font-size: 12px; color: #999;">
                                            ${new Date(winner.created).toLocaleString('zh-CN')}
                                        </div>
                                    </div>
                                </div>
                            `;
                        });
                    } else {
                        // å…¶ä»–ç­‰çº§æ˜¾ç¤ºç®€æ´çš„åˆ—è¡¨
                        html += '<div class="reward-winners-grid">';
                        levelData.winners.forEach(winner => {
                            html += `
                                <div class="reward-winner-card">
                                    <img src="${winner.avatar || 'https://pwl.stackoverflow.wiki/avatar/' + winner.user_id}"
                                         alt="${winner.nickname}" class="reward-avatar"
                                         onerror="this.src='https://pwl.stackoverflow.wiki/avatar/${winner.user_id}'">
                                    <div class="reward-user-info">
                                        <h4>${winner.nickname || winner.username}</h4>
                                        <p>@${winner.username}</p>
                                    </div>
                                    <div class="reward-count">${winner.count}æ¬¡</div>
                                </div>
                            `;
                        });
                        html += '</div>';
                    }
                }

                html += '</div>';
            });

            container.innerHTML = html;
        }

        // æ¸²æŸ“ç¦ç­¾ç»Ÿè®¡
        function renderVotes(votes) {
            // æ›´æ–°è®¡æ•°
            document.getElementById('careerCount').textContent = votes.career?.length || 0;
            document.getElementById('romanceCount').textContent = votes.romance?.length || 0;
            document.getElementById('wealthCount').textContent = votes.wealth?.length || 0;

            // æ¸²æŸ“å„ä¸ªç±»å‹çš„ç¦ç­¾
            renderVoteContent('careerVotesContent', votes.career || []);
            renderVoteContent('romanceVotesContent', votes.romance || []);
            renderVoteContent('wealthVotesContent', votes.wealth || []);
        }

        function renderVoteContent(elementId, voteList) {
            const container = document.getElementById(elementId);

            if (!voteList || voteList.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="icon">ğŸ“­</div><p>æš‚æ— æ•°æ®</p></div>';
                return;
            }

            // æ’åºï¼šé¦–å…ˆæŒ‰æ•°é‡é™åºï¼Œæ•°é‡ç›¸åŒæ—¶æŒ‰æœ€æ–°æŠ•ç¥¨æ—¶é—´é™åº
            const sortedList = [...voteList].sort((a, b) => {
                // é¦–å…ˆæ¯”è¾ƒæ•°é‡
                if (b.count !== a.count) {
                    return b.count - a.count;
                }

                // æ•°é‡ç›¸åŒæ—¶ï¼Œæ¯”è¾ƒæœ€æ–°æŠ•ç¥¨æ—¶é—´
                const aTime = a.voters && a.voters.length > 0 ?
                    Math.max(...a.voters.map(v => new Date(v.created || 0).getTime())) : 0;
                const bTime = b.voters && b.voters.length > 0 ?
                    Math.max(...b.voters.map(v => new Date(v.created || 0).getTime())) : 0;
                return bTime - aTime;
            });

            let html = '';
            sortedList.forEach((recipient, index) => {
                const rankClass = index === 0 ? 'top-1' : index === 1 ? 'top-2' : index === 2 ? 'top-3' : '';
                const rankEmoji = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : index === 2 ? 'ğŸ¥‰' : (index + 1);

                // æŠ•ç¥¨è€…åˆ—è¡¨
                const voters = recipient.voters || [];
                const votersHtml = voters.length > 0 ? `
                    <div class="vote-voters-section">
                        <div class="vote-voters-header">
                            <span class="vote-voters-title">ğŸ’Œ æ¥è‡ª ${voters.length} äººçš„ç¥ç¦</span>
                        </div>
                        <div class="vote-voters-grid">
                            ${voters.map(voter => {
                                const voteTime = voter.created ? new Date(voter.created).toLocaleDateString('zh-CN', {
                                    month: 'short',
                                    day: 'numeric',
                                    hour: '2-digit',
                                    minute: '2-digit'
                                }) : '';
                                return `
                                    <div class="voter-card">
                                        <img src="${voter.avatar || 'https://pwl.stackoverflow.wiki/avatar/' + voter.user_id}"
                                             alt="${voter.nickname}" class="voter-avatar"
                                             onerror="this.src='https://pwl.stackoverflow.wiki/avatar/${voter.user_id}'">
                                        <div class="voter-info">
                                            <p class="voter-name">${voter.nickname || voter.username}</p>
                                            ${voteTime ? `<p class="voter-time">${voteTime}</p>` : ''}
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                ` : '';

                html += `
                    <div class="vote-recipient-card">
                        <div class="vote-recipient-header">
                            <div class="vote-recipient-rank ${rankClass}">${rankEmoji}</div>
                            <img src="${recipient.avatar || 'https://pwl.stackoverflow.wiki/avatar/' + recipient.user_id}"
                                 alt="${recipient.nickname}" class="vote-recipient-avatar"
                                 onerror="this.src='https://pwl.stackoverflow.wiki/avatar/${recipient.user_id}'">
                            <div class="vote-recipient-info">
                                <h3 class="vote-recipient-name">${recipient.nickname || recipient.username}</h3>
                                <p class="vote-recipient-username">@${recipient.username}</p>
                            </div>
                            <div class="vote-recipient-stats">
                                <div class="vote-recipient-count">${recipient.count}</div>
                                <div class="vote-recipient-label">ç¥¨æ•°</div>
                            </div>
                        </div>
                        ${votersHtml}
                    </div>
                `;
            });

            container.innerHTML = html;
        }


        // æ¸²æŸ“æ–‡ç« æ’å
        function renderArticles(articles) {
            const container = document.getElementById('articlesList');
            if (articles.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="icon">ğŸ“„</div><p>æš‚æ— æ–‡ç« æ•°æ®</p></div>';
                return;
            }

            container.innerHTML = articles.map(article => {
                let rankClass = '';
                if (article.rank === 1) rankClass = 'top-1';
                else if (article.rank === 2) rankClass = 'top-2';
                else if (article.rank === 3) rankClass = 'top-3';

                const voteBadges = [];
                if (article.career_votes > 0) {
                    voteBadges.push(`<span class="vote-badge career">ğŸš€ äº‹ä¸šç¬¦ Ã—${article.career_votes}</span>`);
                }
                if (article.romance_votes > 0) {
                    voteBadges.push(`<span class="vote-badge romance">ğŸ’ å§»ç¼˜ç¬¦ Ã—${article.romance_votes}</span>`);
                }
                if (article.wealth_votes > 0) {
                    voteBadges.push(`<span class="vote-badge wealth">ğŸ’° æ‹›è´¢ç¬¦ Ã—${article.wealth_votes}</span>`);
                }

                return `
                    <div class="article-item" onclick="window.open('https://fishpi.cn/article/${article.article_o_id}', '_blank')">
                        <div class="article-header">
                            <div class="article-rank ${rankClass}">#${article.rank}</div>
                            <div class="article-content">
                                <div class="article-title">${article.title}</div>
                                <div class="article-preview">${article.preview_content}</div>
                                <div class="article-author">
                                    <img src="${article.avatar || '/api/files/_pb_users_auth_/' + article.user_id + '/' + article.avatar}"
                                         alt="${article.nickname}" class="article-avatar"
                                         onerror="this.src='https://pwl.stackoverflow.wiki/avatar/${article.user_id}'">
                                    <span>${article.nickname || article.username}</span>
                                </div>
                                <div class="article-stats">
                                    <span class="stat-item"><span class="icon">ğŸ‘ï¸</span> ${article.view_count}</span>
                                    <span class="stat-item"><span class="icon">ğŸ‘</span> ${article.good_cnt}</span>
                                    <span class="stat-item"><span class="icon">ğŸ’¬</span> ${article.comment_count}</span>
                                    <span class="stat-item"><span class="icon">â­</span> ${article.collect_cnt}</span>
                                    <span class="stat-item"><span class="icon">â¤ï¸</span> ${article.thank_cnt}</span>
                                    <span class="stat-item"><span class="icon">ğŸ“Š</span> ç»¼åˆåˆ†: ${article.score.toFixed(2)}</span>
                                </div>
                                ${voteBadges.length > 0 ? `<div class="article-votes">${voteBadges.join('')}</div>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // é¡µé¢åŠ è½½æ—¶è·å–æ•°æ®
        document.addEventListener('DOMContentLoaded', function() {
            loadActivityResult();
        });
    </script>
</body>
</html>
