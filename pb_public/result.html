<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ´»åŠ¨ç»“æœ - æ‘¸é±¼æ´¾ç¥ç¦æ´»åŠ¨</title>
    <link rel="stylesheet" href="https://unpkg.com/layui@2.8.18/dist/css/layui.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        /* å¯¼èˆªå¤´éƒ¨ */
        .nav-header {
            background: white;
            border-radius: 10px;
            padding: 15px 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        .nav-logo {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }
        .nav-menu {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .nav-item {
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #333;
            text-decoration: none;
            font-size: 14px;
        }
        .nav-item:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        /* æ´»åŠ¨ä¿¡æ¯å¡ç‰‡ */
        .activity-info {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .activity-title {
            font-size: 32px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .activity-desc {
            text-align: center;
            color: #666;
            font-size: 16px;
            line-height: 1.8;
            margin-bottom: 20px;
        }

        /* åšé¥¼ç»“æœå¡ç‰‡ */
        .section-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        .section-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .section-title .icon {
            font-size: 28px;
        }

        /* çŠ¶å…ƒå±•ç¤º */
        .champions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .champion-card {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
            position: relative;
            overflow: hidden;
        }
        .champion-card::before {
            content: 'ğŸ‘‘';
            position: absolute;
            top: -10px;
            right: -10px;
            font-size: 80px;
            opacity: 0.2;
        }
        .champion-user {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        .champion-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        .champion-info h3 {
            margin: 0;
            font-size: 18px;
            color: #8B4513;
        }
        .champion-info p {
            margin: 5px 0 0 0;
            font-size: 14px;
            color: #A0522D;
        }
        .champion-details {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            padding: 12px;
            margin-top: 10px;
        }
        .dice-display {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin: 10px 0;
        }
        .dice {
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            color: #FF0000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        /* å‚ä¸è€…åˆ—è¡¨ */
        .participants-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .participant-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            transition: all 0.3s ease;
        }
        .participant-card:hover {
            background: #e9ecef;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .participant-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: 2px solid #667eea;
        }
        .participant-info {
            flex: 1;
        }
        .participant-info h4 {
            margin: 0 0 5px 0;
            font-size: 16px;
            color: #333;
        }
        .participant-info p {
            margin: 0;
            font-size: 14px;
            color: #666;
        }
        .participant-count {
            font-size: 20px;
            font-weight: bold;
            color: #667eea;
        }

        /* ç¦ç­¾ç»Ÿè®¡ */
        .votes-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .vote-section {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
        }
        .vote-section.career {
            border-left: 5px solid #FF6B6B;
        }
        .vote-section.romance {
            border-left: 5px solid #FF69B4;
        }
        .vote-section.wealth {
            border-left: 5px solid #FFD700;
        }
        .vote-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            font-size: 20px;
            font-weight: bold;
        }
        .vote-header .emoji {
            font-size: 28px;
        }
        .vote-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .vote-item {
            background: white;
            border-radius: 8px;
            padding: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .vote-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
        }
        .vote-user-info {
            flex: 1;
        }
        .vote-user-info h5 {
            margin: 0 0 3px 0;
            font-size: 14px;
            color: #333;
        }
        .vote-user-info p {
            margin: 0;
            font-size: 12px;
            color: #999;
        }
        .vote-count {
            font-size: 18px;
            font-weight: bold;
            color: #667eea;
        }

        /* æ–‡ç« æ’å */
        .article-list {
            margin-top: 20px;
        }
        .article-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .article-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .article-header {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin-bottom: 15px;
        }
        .article-rank {
            font-size: 28px;
            font-weight: bold;
            color: #667eea;
            min-width: 50px;
        }
        .article-rank.top-1 {
            color: #FFD700;
        }
        .article-rank.top-2 {
            color: #C0C0C0;
        }
        .article-rank.top-3 {
            color: #CD7F32;
        }
        .article-content {
            flex: 1;
        }
        .article-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        .article-preview {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 10px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        .article-author {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .article-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
        }
        .article-stats {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            font-size: 13px;
            color: #999;
        }
        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .stat-item .icon {
            font-size: 16px;
        }
        .article-votes {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        .vote-badge {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }
        .vote-badge.career {
            background: #FFE5E5;
            color: #FF6B6B;
        }
        .vote-badge.romance {
            background: #FFE5F5;
            color: #FF69B4;
        }
        .vote-badge.wealth {
            background: #FFF8E5;
            color: #FFB900;
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #999;
        }
        .empty-state .icon {
            font-size: 60px;
            margin-bottom: 10px;
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            text-align: center;
            padding: 40px;
        }

        @media (max-width: 768px) {
            .champions-grid,
            .participants-grid,
            .votes-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <div class="nav-header">
        <div class="nav-logo">ğŸ‰ æ‘¸é±¼æ´¾ç¥ç¦æ´»åŠ¨</div>
        <div class="nav-menu">
            <a href="/" class="nav-item">ğŸ  é¦–é¡µ</a>
            <a href="/result.html" class="nav-item" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">ğŸ“Š æ´»åŠ¨ç»“æœ</a>
        </div>
    </div>

    <!-- æ´»åŠ¨ä¿¡æ¯ -->
    <div class="activity-info">
        <div class="activity-title">ğŸŠ æ´»åŠ¨ç»“æœå…¬ç¤º ğŸŠ</div>
        <div class="activity-desc">
            æ„Ÿè°¢å„ä½é±¼æ²¹çš„çƒ­æƒ…å‚ä¸ï¼æœ¬æ¬¡æ´»åŠ¨åœ†æ»¡ç»“æŸï¼Œä»¥ä¸‹æ˜¯æ´»åŠ¨æœ€ç»ˆç»“æœã€‚<br>
            åŒ…æ‹¬åšé¥¼çŠ¶å…ƒã€å‚ä¸ç»Ÿè®¡ã€ç¦ç­¾è·å¾—æƒ…å†µä»¥åŠæ–‡ç« ç»¼åˆæ’åã€‚
        </div>
    </div>

    <!-- åšé¥¼çŠ¶å…ƒ -->
    <div class="section-card" id="championsSection">
        <div class="section-title">
            <span class="icon">ğŸ‘‘</span>
            <span>åšé¥¼çŠ¶å…ƒæ¦œ</span>
        </div>
        <div class="champions-grid" id="championsGrid">
            <div class="loading">åŠ è½½ä¸­...</div>
        </div>
    </div>

    <!-- åšé¥¼å‚ä¸ç»Ÿè®¡ -->
    <div class="section-card" id="participantsSection">
        <div class="section-title">
            <span class="icon">ğŸ²</span>
            <span>åšé¥¼å‚ä¸ç»Ÿè®¡</span>
        </div>
        <div class="participants-grid" id="participantsGrid">
            <div class="loading">åŠ è½½ä¸­...</div>
        </div>
    </div>

    <!-- ç¦ç­¾è·å¾—ç»Ÿè®¡ -->
    <div class="section-card" id="votesSection">
        <div class="section-title">
            <span class="icon">ğŸ®</span>
            <span>ç¦ç­¾è·å¾—ç»Ÿè®¡</span>
        </div>
        <div class="votes-container">
            <div class="vote-section career">
                <div class="vote-header">
                    <span class="emoji">ğŸš€</span>
                    <span>äº‹ä¸šç¬¦</span>
                </div>
                <div class="vote-list" id="careerVotesList">
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>
            <div class="vote-section romance">
                <div class="vote-header">
                    <span class="emoji">ğŸ’</span>
                    <span>å§»ç¼˜ç¬¦</span>
                </div>
                <div class="vote-list" id="romanceVotesList">
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>
            <div class="vote-section wealth">
                <div class="vote-header">
                    <span class="emoji">ğŸ’°</span>
                    <span>æ‹›è´¢ç¬¦</span>
                </div>
                <div class="vote-list" id="wealthVotesList">
                    <div class="loading">åŠ è½½ä¸­...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ–‡ç« ç»¼åˆæ’å -->
    <div class="section-card" id="articlesSection">
        <div class="section-title">
            <span class="icon">ğŸ“</span>
            <span>æ–‡ç« ç»¼åˆæ’å</span>
        </div>
        <div class="article-list" id="articlesList">
            <div class="loading">åŠ è½½ä¸­...</div>
        </div>
    </div>

    <script src="https://unpkg.com/layui@2.8.18/dist/layui.js"></script>
    <script>
        // åŠ è½½æ´»åŠ¨ç»“æœæ•°æ®
        async function loadActivityResult() {
            try {
                const response = await fetch('/activity/result');
                if (!response.ok) {
                    throw new Error('åŠ è½½å¤±è´¥');
                }
                const data = await response.json();

                renderChampions(data.champions || []);
                renderParticipants(data.participants || []);
                renderVotes(data.votes || {});
                renderArticles(data.article_rankings || []);
            } catch (error) {
                console.error('åŠ è½½æ´»åŠ¨ç»“æœå¤±è´¥:', error);
                layui.layer.msg('åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•', {icon: 2});
            }
        }

        // æ¸²æŸ“åšé¥¼çŠ¶å…ƒ
        function renderChampions(champions) {
            const grid = document.getElementById('championsGrid');
            if (champions.length === 0) {
                grid.innerHTML = '<div class="empty-state"><div class="icon">ğŸ²</div><p>æš‚æ— çŠ¶å…ƒæ•°æ®</p></div>';
                return;
            }

            grid.innerHTML = champions.map(champion => {
                const details = JSON.parse(champion.details || '[]');
                const diceHtml = details.map(d => `<div class="dice">${d}</div>`).join('');

                return `
                    <div class="champion-card">
                        <div class="champion-user">
                            <img src="${champion.avatar || '/api/files/_pb_users_auth_/' + champion.user_id + '/' + champion.avatar}"
                                 alt="${champion.nickname}" class="champion-avatar"
                                 onerror="this.src='https://pwl.stackoverflow.wiki/avatar/${champion.user_id}'">
                            <div class="champion-info">
                                <h3>${champion.nickname || champion.username}</h3>
                                <p>@${champion.username}</p>
                            </div>
                        </div>
                        <div class="champion-details">
                            <div style="text-align: center; margin-bottom: 8px; font-weight: bold; color: #8B4513;">
                                ç¬¬ ${champion.times} æ¬¡åšé¥¼
                            </div>
                            <div class="dice-display">
                                ${diceHtml}
                            </div>
                            <div style="text-align: center; margin-top: 8px; font-size: 12px; color: #999;">
                                ${new Date(champion.created).toLocaleString('zh-CN')}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // æ¸²æŸ“å‚ä¸è€…ç»Ÿè®¡
        function renderParticipants(participants) {
            const grid = document.getElementById('participantsGrid');
            if (participants.length === 0) {
                grid.innerHTML = '<div class="empty-state"><div class="icon">ğŸ‘¥</div><p>æš‚æ— å‚ä¸æ•°æ®</p></div>';
                return;
            }

            grid.innerHTML = participants.map(p => `
                <div class="participant-card">
                    <img src="${p.avatar || '/api/files/_pb_users_auth_/' + p.user_id + '/' + p.avatar}"
                         alt="${p.nickname}" class="participant-avatar"
                         onerror="this.src='https://pwl.stackoverflow.wiki/avatar/${p.user_id}'">
                    <div class="participant-info">
                        <h4>${p.nickname || p.username}</h4>
                        <p>@${p.username}</p>
                    </div>
                    <div class="participant-count">${p.count}æ¬¡</div>
                </div>
            `).join('');
        }

        // æ¸²æŸ“ç¦ç­¾ç»Ÿè®¡
        function renderVotes(votes) {
            renderVoteList('careerVotesList', votes.career || []);
            renderVoteList('romanceVotesList', votes.romance || []);
            renderVoteList('wealthVotesList', votes.wealth || []);
        }

        function renderVoteList(elementId, voteList) {
            const container = document.getElementById(elementId);
            if (voteList.length === 0) {
                container.innerHTML = '<div class="empty-state"><p style="font-size: 14px;">æš‚æ— æ•°æ®</p></div>';
                return;
            }

            container.innerHTML = voteList.map(v => `
                <div class="vote-item">
                    <img src="${v.avatar || '/api/files/_pb_users_auth_/' + v.user_id + '/' + v.avatar}"
                         alt="${v.nickname}" class="vote-avatar"
                         onerror="this.src='https://pwl.stackoverflow.wiki/avatar/${v.user_id}'">
                    <div class="vote-user-info">
                        <h5>${v.nickname || v.username}</h5>
                        <p>@${v.username}</p>
                    </div>
                    <div class="vote-count">${v.count}</div>
                </div>
            `).join('');
        }

        // æ¸²æŸ“æ–‡ç« æ’å
        function renderArticles(articles) {
            const container = document.getElementById('articlesList');
            if (articles.length === 0) {
                container.innerHTML = '<div class="empty-state"><div class="icon">ğŸ“„</div><p>æš‚æ— æ–‡ç« æ•°æ®</p></div>';
                return;
            }

            container.innerHTML = articles.map(article => {
                let rankClass = '';
                if (article.rank === 1) rankClass = 'top-1';
                else if (article.rank === 2) rankClass = 'top-2';
                else if (article.rank === 3) rankClass = 'top-3';

                const voteBadges = [];
                if (article.career_votes > 0) {
                    voteBadges.push(`<span class="vote-badge career">ğŸš€ äº‹ä¸šç¬¦ Ã—${article.career_votes}</span>`);
                }
                if (article.romance_votes > 0) {
                    voteBadges.push(`<span class="vote-badge romance">ğŸ’ å§»ç¼˜ç¬¦ Ã—${article.romance_votes}</span>`);
                }
                if (article.wealth_votes > 0) {
                    voteBadges.push(`<span class="vote-badge wealth">ğŸ’° æ‹›è´¢ç¬¦ Ã—${article.wealth_votes}</span>`);
                }

                return `
                    <div class="article-item" onclick="window.open('https://fishpi.cn/article/${article.article_o_id}', '_blank')">
                        <div class="article-header">
                            <div class="article-rank ${rankClass}">#${article.rank}</div>
                            <div class="article-content">
                                <div class="article-title">${article.title}</div>
                                <div class="article-preview">${article.preview_content}</div>
                                <div class="article-author">
                                    <img src="${article.avatar || '/api/files/_pb_users_auth_/' + article.user_id + '/' + article.avatar}"
                                         alt="${article.nickname}" class="article-avatar"
                                         onerror="this.src='https://pwl.stackoverflow.wiki/avatar/${article.user_id}'">
                                    <span>${article.nickname || article.username}</span>
                                </div>
                                <div class="article-stats">
                                    <span class="stat-item"><span class="icon">ğŸ‘ï¸</span> ${article.view_count}</span>
                                    <span class="stat-item"><span class="icon">ğŸ‘</span> ${article.good_cnt}</span>
                                    <span class="stat-item"><span class="icon">ğŸ’¬</span> ${article.comment_count}</span>
                                    <span class="stat-item"><span class="icon">â­</span> ${article.collect_cnt}</span>
                                    <span class="stat-item"><span class="icon">â¤ï¸</span> ${article.thank_cnt}</span>
                                    <span class="stat-item"><span class="icon">ğŸ“Š</span> ç»¼åˆåˆ†: ${article.score.toFixed(2)}</span>
                                </div>
                                ${voteBadges.length > 0 ? `<div class="article-votes">${voteBadges.join('')}</div>` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // é¡µé¢åŠ è½½æ—¶è·å–æ•°æ®
        document.addEventListener('DOMContentLoaded', function() {
            loadActivityResult();
        });
    </script>
</body>
</html>
